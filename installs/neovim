#!/usr/bin/env bash
set -euo pipefail

# --- Variables ---
DOTFILES_DIR="${DOTFILES_DIR:-$(cd "$(dirname "${BASH_SOURCE[0]}")/../" >/dev/null 2>&1 && pwd)}"
NVIM_CONFIG_DIR="$HOME/.config/nvim"

# --- Logging function ---
log() {
	echo "[INFO] $1"
}

# --- Ensure snapd is installed ---
if ! command -v snap >/dev/null 2>&1; then
	log "snapd not found. Installing snapd..."
	sudo apt update -y
	sudo apt install -y snapd
else
	log "snapd is already installed."
fi

# --- Install Neovim ---
if ! command -v nvim >/dev/null 2>&1; then
	log "Installing Neovim via snap..."
	sudo snap install nvim --classic
else
	log "Neovim is already installed."
fi

# --- Load createSymlink function ---
source "$DOTFILES_DIR/symlink.sh"

# --- Setup Neovim configuration ---
log "Setting up Neovim config at $NVIM_CONFIG_DIR..."
mkdir -p "$NVIM_CONFIG_DIR"

createSymlink "$DOTFILES_DIR/nvim" "$NVIM_CONFIG_DIR"

log "Neovim setup complete!"
